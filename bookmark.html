<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap">
    <link rel="stylesheet" href="./styles/style.css">

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/eruda"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/12.1.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore-compat.js"></script>

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-GP8PTD3TLS"></script>
    <script async src="https://accounts.google.com/gsi/client" defer></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-GP8PTD3TLS');
    </script>

    <script src="./scripts/firebaseDB.js"></script>
    <script src="./scripts/googleScript.js"></script>
    <script src="./scripts/googleAuth.js"></script>
    <script src="./scripts/seriesController.js"></script>
    <script src="./scripts/functions.js"></script>

    <link rel="icon" type="image/x-icon" href="./icons/favicon.ico">
    <meta property="og:image" content="https://www.lilyreader.online/icons/icon.png">
    <meta property="og:image:type" content="image/png">
    <meta property="og:image:width" content="1024">
    <meta property="og:image:height" content="1024">
    <meta property="og:title" content="LILY READER">
    <meta property="og:description" content="대세는 백합 갤번역 리더기 by.LILYD3V">
    <title>북마크 관리 | LilyReader</title>

    <style>
        input,
        textarea,
        select {
            touch-action: manipulation;
        }
    </style>
</head>

<body class="d-flex flex-column min-vh-100" data-bs-theme="dark">
    <nav></nav>

    <div id="main-container" class="container-md mb-4">
        <nav aria-label="breadcrumb" class="mt-3">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="./">목록</a></li>
                <li class="breadcrumb-item active w-75 text-truncate" aria-current="page">북마크 관리</li>
            </ol>
        </nav>
        <div class="d-flex border-bottom py-2 mb-3">
            <div id="tags" class="d-flex gap-1 overflow-x-auto me-3"></div>
        </div>
        <div class="d-flex mt-3">
            <button id="current-sort" class="btn btn-sm btn-outline-body dropdown-toggle" type="button"
                data-bs-toggle="dropdown" aria-expanded="false">정렬</button>
            <ul class="dropdown-menu" id="sortby">
                <li>
                    <button class="dropdown-item" type="button" onclick="sortSeries('datetime', true); reloadSeries();"
                        data-sortby="datetime-asc">
                        <small>최근 업데이트 <i class="bi bi-sort-down-alt"></i></small>
                    </button>
                </li>
                <li>
                    <button class="dropdown-item" type="button" onclick="sortSeries('datetime', false); reloadSeries();"
                        data-sortby="datetime-desc">
                        <small>최근 업데이트 <i class="bi bi-sort-down"></i></small>
                    </button>
                </li>
                <li>
                    <button class="dropdown-item" type="button" onclick="sortSeries('abc', true); reloadSeries();"
                        data-sortby="abc-asc">
                        <small>가나다 <i class="bi bi-sort-down-alt"></i></small>
                    </button>
                </li>
                <li>
                    <button class="dropdown-item" type="button" onclick="sortSeries('abc', false); reloadSeries();"
                        data-sortby="abc-desc">
                        <small>가나다 <i class="bi bi-sort-down"></i></small>
                    </button>
                </li>
            </ul>
            <div id="view-radio" class="btn-group btn-group-sm ms-auto" role="group"
                aria-label="Basic radio toggle button group">
                <input type="radio" class="btn-check" name="btnradio" id="btnlist" autocomplete="off"
                    onchange="if(this.checked) {currView('list')}" checked>
                <label class="btn btn-outline-body" for="btnlist"><i class="bi bi-view-stacked"></i></label>
                <input type="radio" class="btn-check" name="btnradio" id="btngrid" autocomplete="off"
                    onchange="if(this.checked) {currView('grid')}">
                <label class="btn btn-outline-body" for="btngrid"><i class="bi bi-grid"></i></label>
            </div>
        </div>
        <div class="accordion my-3" id="series-list"></div>
    </div>

    <footer></footer>

    <div id="spinner" class="bg-body bg-opacity-50 position-fixed top-0 bottom-0 start-0 end-0 z-5">
        <div class="position-absolute top-50 start-50 translate-middle z-3">
            <div class="d-flex justify-content-center my-3">
                <div class="spinner-border" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('dev') && urlParams.get('dev') === 'true') {
            eruda.init();
        }

        const firebaseDB = new FirebaseDB();
        var seriesList = [];
        var user = null;

        init();

        async function init() {
            await initPage();

            loadView();
            loadTags();
            document.getElementById('series-list').innerHTML = '';
            const data = await firebaseDB.readData();
            hideSpinner();
            seriesList = [];
            data.forEach(d => {
                if (user && user.bookmarks && user.bookmarks.includes(d.id)) {
                    seriesList.push(convertSeries(d));
                }
            });

            sortSeries('datetime', false);
            if (seriesList.length > 0) {
                for (const series of seriesList) {
                    loadSeries(series);
                }
            }
        }

    </script>

</body>

</html>